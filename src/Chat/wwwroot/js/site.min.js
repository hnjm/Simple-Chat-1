function PrivateChat(e,s,o){var n=this;n.connectionId=ko.observable(e),n.username=ko.observable(s),n.newMessage=ko.observable(),n.messages=ko.observableArray(null==o?[]:[new PrivateMessage(o.from,o.text)])}function PrivateMessage(e,s,o){var n=this;n.from=ko.observable(e),n.text=ko.observable(s),n.isSelf=ko.observable(o)}var viewModel={username:ko.observable(null),users:ko.observableArray([]),messages:ko.observableArray([]),message:ko.observable(null),privateMessages:ko.observableArray([]),isLoading:ko.observable(!1),hasUsername:ko.observable(!1),hub:{},addPublicMessage:function(e){viewModel.messages.push(e)},addPrivateMessage:function(e){var s=ko.utils.arrayFirst(viewModel.privateMessages(),function(s){return e.FromUserConnectionId==s.connectionId()?!0:!1}),o=new PrivateMessage(e.FromUser,e.Text,!1);s?s.messages.push(o):viewModel.privateMessages.push(new PrivateChat(e.FromUserConnectionId,e.FromUser,o))},sendMessage:function(){var e=viewModel.message(),s=viewModel.username();return viewModel.hub.server.sendMessage(s,e,null),viewModel.message(null),!1},sendPrivateMessage:function(){var e=this,s=viewModel.username(),o=e.newMessage(),n=ko.utils.arrayFirst(viewModel.privateMessages(),function(s){return e.fromUserConnectionId==s.fromUserConnectionId?!0:!1}),a=new PrivateMessage(s,o,!0);return n.messages.push(a),viewModel.hub.server.sendMessage(s,o,e.connectionId()),e.newMessage(null),!1},openChatWindow:function(){var e=this,s=ko.utils.arrayFirst(viewModel.privateMessages(),function(s){return e.Item1==s.connectionId()?!0:!1});s||viewModel.privateMessages.push(new PrivateChat(e.Item1,e.Item2,null))},closeChatWindow:function(){var e=this;viewModel.privateMessages.remove(e)},selectUsername:function(){viewModel.hasUsername(!0),viewModel.connect()},connect:function(){viewModel.isLoading(!0),viewModel.hub=$.connection.messages,viewModel.hub.client.receivePublicMessage=function(e){viewModel.addPublicMessage(e)},viewModel.hub.client.receivePrivateMessage=function(e){viewModel.addPrivateMessage(e)},viewModel.hub.client.updateUsers=function(e){viewModel.users(e)},$.connection.hub.qs="name="+viewModel.username(),$.connection.hub.start().done(function(){viewModel.isLoading(!1)})}};ko.applyBindings(viewModel,$("#chat-hub")[0]);